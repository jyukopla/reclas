<rules xmlns="http://namespaces.plone.org/diazo"
       xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

  <!-- 'theme' is the node with data-tile="" -->
  <!-- 'content' is the /body node the tile  -->

  <replace theme="/*">
    <footer class="container hidden-print">
      <div class="row">
        <xsl:apply-templates select="/body/*[node()]" />
      </div>
    </footer>
  </replace>

  <!-- Flatten -->
  <xsl:template match="div|section|header">
    <xsl:apply-templates />
  </xsl:template>

  <!-- Allow full size text portlets-->
  <xsl:template match="p[ancestor::*[1][contains(@class, 'portlet')]]">
    <div class="col-12">
      <xsl:copy>
        <xsl:apply-templates select="@*|node()" />
      </xsl:copy>
    </div>
  </xsl:template>

  <!-- Transform tables to responsive grid -->
  <xsl:template match="table">
     <xsl:for-each select="//td">
       <xsl:choose>
         <xsl:when test="position() = 1">
           <div class="col-md-6 col-lg-3">
             <xsl:apply-templates />
           </div>
         </xsl:when>
         <xsl:when test="position() = last()">
           <div class="col-md-6 col-lg-3">
             <xsl:apply-templates />
           </div>
         </xsl:when>
         <xsl:otherwise>
           <div class="col-md-6 col-lg-3">
             <xsl:apply-templates />
           </div>
         </xsl:otherwise>
       </xsl:choose>
     </xsl:for-each>
  </xsl:template>

</rules>
